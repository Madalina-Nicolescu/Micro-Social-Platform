
@{
    ViewBag.Title = "Index";
}
<h1>@ViewBag.Message</h1>

<div class="container">
    <div class="pull-right">
        <br />
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">
                <form class="card card-sm" method="GET">
                    <div class="card-body row no-gutters align-items-center">
                        <div class="col-auto">
                            <i class="fas fa-search h4 text-body"></i>
                        </div>
                        <!--end of col-->
                        <div class="col">
                            <input class="form-control form-control-lg form-controlborderless" type="text" name="search"
                                   value="@ViewBag.SearchString"
                                   placeholder="Search user">
                        </div>
                        <!--end of col-->
                        <div class="col-auto">
                            <button class="btn btn-lg btn-success"
                                    type="submit">
                                Search
                            </button>
                        </div>
                        <!--end of col-->
                    </div>
                </form>
            </div>
            <!--end of col-->
        </div>
    </div>
</div>
<br />

@if (ViewBag.search != "" && ViewBag.CountUsers > 0)
{
    <div class="dropdown pull-right">
        <button class="dropbtn">Search results</button>
        <div class="dropdown-content">
            @foreach (var user in ViewBag.UsersList)
            {
                <li class="dropdown-item" style="list-style-type: none">
                    <a href="/Profiles/Show/@user.Id" class="glyphicon glyphicon-user"> @user.UserName </a>
                    <br />
                </li>}
        </div>
    </div>
    ViewBag.CountUsers = 0;
}


<br />
<hr />


<div class="row">
    <div class="col-sm-2"></div>
    <div class="panel panel-default col-sm-8" style="text-align: center; width: 70%; margin-left: 15%; display:inline">
        <div class="panel-body">

            @using (Html.BeginForm(actionName: "New", controllerName: "Posts"))
            {
                @Html.Hidden("UserId")

                @Html.Label("Content", "Scrie o postare")
                <br />
                @Html.TextArea("Content", null, new { @class = "form-control" })
                <br />
                @Html.ValidationMessage("Content", "", new { @class = "text-danger" })
                <br />
                <br />
                <button class="btn btn-success" type="submit" style=" background: #5680e9; border-color: #5680e9"> Adauga postare</button>
            }


        </div>
    </div>
    <div class="col-sm-2"></div>
</div>



@foreach (var post in ViewBag.Posts)
{

    int isFriend = 0;
    foreach (var fr in ViewBag.Friends)
    {
        if ((fr.User1_Id == post.User.Id && fr.User2_Id == ViewBag.CurrentUser.Id) || (fr.User2_Id == post.User.Id && fr.User1_Id == ViewBag.CurrentUser.Id))
        {

            if (fr.Accepted == true)
            {
                isFriend = 1;
                break;
            }
        }
    }
    if (isFriend == 1 || (post.User.Id == ViewBag.CurrentUser.Id) || ViewBag.isAdmin)
    {
                <br />
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="panel panel-default col-sm-8">
                        <div class="panel-heading">
                            @if (post.GroupId == 1)
                            {
                                <i class="glyphicon glyphicon-user"></i>
                                <a href="/Profiles/Show/@post.User.Id"> @post.User.UserName </a>
                                <br />
                                <small>@post.Date</small>

                            }
                            else
                            {
                                <i class="glyphicon glyphicon-user"></i>
                                <a href="/Profiles/Show/@post.User.Id"> @post.User.UserName </a> <i> > <a href="/Groups/Show/@post.GroupId"> @post.Group.GroupName</a></i>
                                <br />
                                <small>@post.Date</small>
                            }
                        </div>
                        <div class="panel-body">
                            <br /><br /><strong>@post.Content</strong>
                            <br />
                            <!--<span class="label label-success">@post.Date</span>-->
                            <br />
                            <br />


                        </div>
                        <div class="panel-footer">
                            <i class="glyphicon glyphicon-comment"></i>
                            <a href="/Posts/Show/@post.PostId">Comenteaza</a>
                        </div>

                    </div>
                    <div class="col-sm-2"></div>
                </div>
        
    }
    
}